# -------------------------------------------------------------------
#  AUTENTICACIN GOOGLE (OAuth 2.0)
# -------------------------------------------------------------------
# Gu铆a de Configuraci贸n:
# 1. Ve a: https://console.cloud.google.com/apis/credentials
# 2. Selecciona el proyecto 'pristinoplant'.
# 3. Si no existe, crea una credencial: "Crear Credenciales" > "ID de cliente de OAuth".
# 4. Tipo de aplicaci贸n: "Aplicaci贸n web".
# 5. CONFIGURACIN CRTICA (URIs de redireccionamiento autorizados):
#    Debes agregar EXACTAMENTE estas rutas en la consola de Google:
#    - Desarrollo: http://localhost:3000/api/auth/callback/google
#    - Producci贸n: https://pristinoplant.vercel.app/api/auth/callback/google
# -------------------------------------------------------------------
AUTH_GOOGLE_ID=tu-google-client-id.apps.googleusercontent.com
AUTH_GOOGLE_SECRET=tu-google-client-secret


# -------------------------------------------------------------------
# 锔 Configuraci贸n de NextAuth.js
# -------------------------------------------------------------------
# https://generate-secret.vercel.app/32
# Esta clave se utiliza para cifrar las cookies, garantizando la seguridad de las sesiones de los usuarios.
# -------------------------------------------------------------------
AUTH_SECRET=generar-con-openssl-rand-base64-32


# -------------------------------------------------------------------
#  Gu铆a de Configuraci贸n de la Base de Datos (Vercel Neon)
# -------------------------------------------------------------------
# 1. Ve a: https://console.neon.tech/app/projects (o Vercel > Storage > Neon)
# 2. Selecciona tu proyecto y aseg煤rate de estar en la rama "main".
# 3. Ve al Dashboard y haz clic en "Connect".
# 3. Selecciona "Connection string".
# 4. CONFIGURACIN DE URLS (Necesitas dos variables para Prisma + Serverless):
#    A) DATABASE_URL (Para la App - Pooled):
#       - Activa el interruptor "Connection pooling".
#       - Esta URL gestiona miles de conexiones simult谩neas.
#    B) DATABASE_URL_UNPOOLED (Para Migraciones - Unpooled):
#       - Desactiva el interruptor "Connection pooling".
#       - Esta URL se usa solo para `prisma migrate deploy`.
# 5. AJUSTES CRTICOS (Correcciones aplicadas):
#    - SSL: Debe terminar en "?sslmode=require".
#    - Latencia: Agrega "&connect_timeout=30" al final de DATABASE_URL para evitar
#      errores de conexi贸n desde redes lentas (Venezuela) o arranques en fr铆o.
#    - Latencia del pool: Agrega "&pool_timeout=30"
#      Si el pool de conexiones est谩 lleno, espera 30 segundos a que se libere una.
# -------------------------------------------------------------------


# -------------------------------------------------------------------
#  CREDENCIALES MQTT (Roles del Sistema)
# -------------------------------------------------------------------
# Referencia de configuraci贸n: Ver infrastructure/mosquitto/config/passwd.template
# Definimos usuarios espec铆ficos para cada componente del sistema.
# Esto permite auditor铆a y control de acceso (ACLs) granular.

# ADMIN (MQTT Explorer)
MQTT_ROOT_USER=pristinoplant
MQTT_ROOT_PASS=tu-password-segura-admin

# BACKEND (Servicios Ingest y Scheduler)
# Usado por: services/ingest y services/scheduler
MQTT_USER_BACKEND=pristinoplant-backend
MQTT_PASS_BACKEND=tu-password-segura-backend

# FRONTEND (Cliente Web Next.js)
# Usado por: app (browser) v铆a WebSockets
MQTT_USER_FRONTEND=pristinoplant-web-client
MQTT_PASS_FRONTEND=tu-password-segura-frontend

# IOT DEVICES (Firmware ESP32)
# Usado por: firmware/sensors y firmware/relay_modules
MQTT_USER_IOT=pristinoplant-iot-device
MQTT_PASS_IOT=tu-password-segura-iot

# -------------------------------------------------------------------
#  Identificicacion de los Servicos del Backend
# -------------------------------------------------------------------
MQTT_CLIENT_ID_INGEST="PristinoPlant-Ingest"
MQTT_CLIENT_ID_SCHEDULER="PristinoPlant-Scheduler"

# -------------------------------------------------------------------
#  CONFIGURACIN DE INFRAESTRUCTURA (Docker Profiles)
# -------------------------------------------------------------------

# Base de Datos Local (Postgres Container Config)
DB_USER=usuario_local
DB_PASSWORD=password_local
DB_HOST=localhost
DB_PORT=5432
DB_NAME=pristinoplant

# InfluxDB (Token Admin)
# En Local (Generalo con 'docker exec -it influxdb influxdb3 create token --admin')
# En Cloud (ingresa a https://us-east-1-1.aws.cloud2.influxdata.com) busca (GENERATE API TOKEN)
INFLUX_TOKEN="tu-token-influxdb-admin"
INFLUX_ORG=PristinoPlant
INFLUX_BUCKET=telemetry
INFLUX_USER="Nombre Usuario"

# -------------------------------------------------------------------
# 锔 CONFIGURACIN DE CONEXINES
# -------------------------------------------------------------------

# A. PERFIL CLOUD (Servicios: ingest-cloud, scheduler-cloud)

# 1. Base de Datos (Neon)
DB_HOST_CLOUD=host-pooler.neon.tech
DB_USER_CLOUD=neondb_owner
DATABASE_URL_CLOUD=postgresql://usuario:pass@host-pooler.neon.tech/neondb?sslmode=require&connect_timeout=60&pool_timeout=60
DATABASE_URL_CLOUD_UNPOOLED=postgresql://usuario:pass@host.neon.tech/neondb?sslmode=require&connect_timeout=60&pool_timeout=60

# 2. MQTT (HiveMQ Cloud)
MQTT_BROKER_URL_CLOUD=mqtts://tu-cluster.hivemq.cloud:8883

# 3. InfluxDB (Cloud v3)
INFLUX_URL_CLOUD='https://us-east-1-1.aws.cloud2.influxdata.com'


# B. PERFIL LOCAL (Servicios: ingest-local, scheduler-local)

# 1. Base de Datos (Interna Docker)
 DATABASE_URL_LOCAL=postgresql://${DB_USER}:${DB_PASSWORD}@postgres:${DB_PORT}/${DB_NAME}?schema=public

# 2. MQTT (Interno Docker)
MQTT_BROKER_URL_LOCAL=mqtt://mosquitto:1883

# 3. InfluxDB (Interno Docker)
INFLUX_URL_LOCAL=http://influxdb:8181


# -------------------------------------------------------------------
#  APP NEXT.JS (Entorno del Cliente/Host)
# -------------------------------------------------------------------
# Configura aqu铆 las credenciales que usar谩 TU PC cuando ejecutes "pnpm dev".
# Esto define si tu entorno de desarrollo local se conecta a:
# - Opci贸n A: Servicios en la Nube (Datos reales, Producci贸n/Staging)
# - Opci贸n B: Servicios Locales (Docker, Datos de prueba)
# -------------------------------------------------------------------

# 1. Base de Datos
# >> Opci贸n A: Cloud (Neon) <<
DATABASE_URL=${DATABASE_URL_CLOUD}
DATABASE_URL_UNPOOLED=${DATABASE_URL_CLOUD_UNPOOLED}

# >> Opci贸n B: Local (Postgres Docker) <<
# DATABASE_URL=${DATABASE_URL_LOCAL}

# 2. MQTT
NEXT_PUBLIC_MQTT_BASE_TOPIC=PristinoPlant
NEXT_PUBLIC_MQTT_USERNAME=${MQTT_USER_FRONTEND}
NEXT_PUBLIC_MQTT_PASSWORD=${MQTT_PASS_FRONTEND}

# >> Opci贸n A: Cloud (HiveMQ) <<
NEXT_PUBLIC_MQTT_PROTOCOL=wss
NEXT_PUBLIC_MQTT_BROKER=tu-cluster.hivemq.cloud
NEXT_PUBLIC_MQTT_PORT=8884

# >> Opci贸n B: Local (Mosquitto Docker) <<
# NEXT_PUBLIC_MQTT_PROTOCOL=ws
# NEXT_PUBLIC_MQTT_BROKER=localhost
# NEXT_PUBLIC_MQTT_PORT=9001

# -------------------------------------------------------------------
# NOTA SOBRE 'DATABASE_URL_UNPOOLED':
# - En Neon (Cloud): Es OBLIGATORIA para migraciones porque conecta sin Pooler.
# - En Docker (Local): No existe "Pooler", por lo que si se define,
#   debe ser id茅ntica a DATABASE_URL. Si se omite, Prisma usar谩 DATABASE_URL.
# -------------------------------------------------------------------
